"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6838],{6838:(at,x,a)=>{a.r(x),a.d(x,{ApprovalsPageModule:()=>nt});var d=a(6895),u=a(4006),i=a(603),v=a(5861),N=a(671),g=a(8505),O=a(3900),t=a(4650),b=a(9586),f=a(1948),T=a(284),y=a(9549),h=a(9383);function M(n,p){1&n&&t._UZ(0,"ion-icon",17),2&n&&t.Q6J("ios","close-outline")("md","close-sharp")}function F(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",1),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.onFormSubmit())}),t._UZ(1,"ion-icon",17),t.qZA()}2&n&&(t.xp6(1),t.Q6J("ios","checkmark-outline")("md","checkmark-sharp"))}function q(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",1),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.onCancel())}),t._UZ(1,"ion-icon",17),t.qZA()}2&n&&(t.xp6(1),t.Q6J("ios","close-outline")("md","close-sharp"))}function _(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",18),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.onFormSubmit())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("disabled",!e.form.valid),t.xp6(1),t.hij(" ",t.lcZ(2,2,"btn.save")," ")}}let J=(()=>{class n{constructor(e,s,o){this.modalCtrl=e,this.screenSizeSrv=s,this.formBuilder=o,this.minDisabled=!0,this.isDesktop$=this.screenSizeSrv.isDesktopView()}ngOnInit(){var e;console.log(this.request),this.form=this.formBuilder.group({status:["",{validators:[u.kI.compose([u.kI.required])]}],minutes:[this.request.minutes,{}]}),null===(e=this.form.get("minutes"))||void 0===e||e.disable()}onCancel(){this.modalCtrl.dismiss(null,"cancel")}onFormSubmit(){this.form.valid&&this.modalCtrl.dismiss({formValue:this.form.value},"confirm")}onKeyPress(e){let o=String.fromCharCode(e.charCode);8!=e.keyCode&&!/[0-9\+\-\ ]/.test(o)&&e.preventDefault()}onStatusChange(e){var s,o,r;if("3"===e.value)null===(s=this.form.get("minutes"))||void 0===s||s.clearValidators(),null===(o=this.form.get("minutes"))||void 0===o||o.updateValueAndValidity(),null===(r=this.form.get("minutes"))||void 0===r||r.disable();else if("2"===e.value){var c,l,m;null===(c=this.form.get("minutes"))||void 0===c||c.addValidators([u.kI.required,u.kI.pattern("^(0|[1-9][0-9]*)$")]),null===(l=this.form.get("minutes"))||void 0===l||l.updateValueAndValidity(),null===(m=this.form.get("minutes"))||void 0===m||m.enable()}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(i.IN),t.Y36(b.j),t.Y36(u.qu))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-change-status"]],inputs:{request:"request"},decls:38,vars:23,consts:[["slot","start"],[3,"click"],["slot","icon-only",3,"ios","md",4,"ngIf"],["slot","end"],[3,"click",4,"ngIf","ngIfElse"],["closeButton",""],[1,"ion-padding"],["size","6","push","3"],[3,"formGroup"],["formControlName","status",3,"change"],["size","12"],["value","3"],["value","2"],[1,"ion-padding-top"],["appearance","outline","floatLabel","always","hideRequiredMarker","true"],["type","text","inputmode","numeric","pattern","[0-9]*","matInput","","formControlName","minutes",3,"keypress"],["fill","outline","expand","block",3,"disabled","click",4,"ngIf"],["slot","icon-only",3,"ios","md"],["fill","outline","expand","block",3,"disabled","click"]],template:function(e,s){if(1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),t.NdJ("click",function(){return s.onCancel()}),t.YNc(4,M,1,2,"ion-icon",2),t.ALo(5,"async"),t.qZA()(),t.TgZ(6,"ion-title"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"ion-buttons",3),t.YNc(10,F,2,2,"ion-button",4),t.ALo(11,"async"),t.YNc(12,q,2,2,"ng-template",null,5,t.W1O),t.qZA()()(),t.TgZ(14,"ion-content",6)(15,"ion-grid")(16,"ion-row")(17,"ion-col",7)(18,"form",8)(19,"mat-radio-group",9),t.NdJ("change",function(r){return s.onStatusChange(r)}),t.TgZ(20,"ion-row")(21,"ion-col",10)(22,"mat-radio-button",11),t._uU(23),t.ALo(24,"translate"),t.qZA()(),t.TgZ(25,"ion-col",10)(26,"mat-radio-button",12),t._uU(27),t.ALo(28,"translate"),t.qZA()()()(),t.TgZ(29,"ion-row",13)(30,"ion-col")(31,"mat-form-field",14)(32,"mat-label"),t._uU(33),t.ALo(34,"translate"),t.qZA(),t.TgZ(35,"input",15),t.NdJ("keypress",function(r){return s.onKeyPress(r)}),t.qZA()()()(),t.YNc(36,_,3,4,"ion-button",16),t.ALo(37,"async"),t.qZA()()()()()),2&e){const o=t.MAs(13);t.xp6(4),t.Q6J("ngIf",!1===t.lcZ(5,9,s.isDesktop$)),t.xp6(3),t.Oqu(t.lcZ(8,11,"labels.changeStatus")),t.xp6(3),t.Q6J("ngIf",!1===t.lcZ(11,13,s.isDesktop$))("ngIfElse",o),t.xp6(8),t.Q6J("formGroup",s.form),t.xp6(5),t.hij(" ",t.lcZ(24,15,"btn.decline")," "),t.xp6(4),t.hij(" ",t.lcZ(28,17,"btn.approve")," "),t.xp6(6),t.Oqu(t.lcZ(34,19,"minutes")),t.xp6(3),t.Q6J("ngIf",t.lcZ(37,21,s.isDesktop$))}},dependencies:[d.O5,u._Y,u.Fj,u.JJ,u.JL,u.c5,i.YG,i.Sm,i.wI,i.W2,i.jY,i.Gu,i.gu,i.Nd,i.wd,i.sr,u.sg,u.u,f.VQ,f.U0,T.Nt,y.KE,y.hX,d.Ov,h.X$]}),n})();var D=a(1135),S=a(4004),A=a(262),C=a(2843),P=a(3151),I=a(2340),w=a(529),E=a(6832);let Y=(()=>{class n{constructor(e,s){this.http=e,this.messagesSrv=s,this.approvals$=new D.X([]),this.approvals=this.approvals$.asObservable(),this.statuses$=new D.X([]),this.statuses=this.statuses$.asObservable(),this.getStatuses().subscribe()}getMyApprovals(){return this.http.get("http://localhost:3000/reports?_page=0&_limit=150").pipe((0,S.U)(s=>s.map(o=>({id:o.ID,requestorId:o.Requestor_ID,requestorWO:o.Requestor_WO,requestorFullName:o.Requestor_FullName,requestorWOManager:o.Requestor_WO_Manager,requestorDepartment:o.Requestor_Department,requestorForWO:o.Requestor_For_WO,requestorForProject:o.Requestor_For_Project,reason:o.Reason,startTime:new Date(o.Start_Time),endTime:new Date(o.End_Time),minutes:o.Minutes,status:o.Status,responseDate:o.ResponseDate?new Date(o.ResponseDate):null,createdAt:new Date(o.CreateDate)}))),(0,A.K)(s=>(this.messagesSrv.showErrors(s.error.Message?s.error.Message:s.status&&s.statusText?s.status+" "+s.statusText:s.message),(0,C._)(()=>s))),(0,g.b)(s=>{this.approvals$.next(s.sort((o,r)=>o.createdAt<r.createdAt?1:o.createdAt>r.createdAt?-1:0))}),(0,P.d)())}updateStatus(e,s,o){const r=this.approvals$.getValue(),c=r.filter(l=>l.id!==e);return this.approvals$.next(c),this.http.post(`${I.N.apiUrl}/Employee/UpdateRequestStatus`,{RequestID:e,RequestStatus:s,Minutes:null!=o?o:null}).pipe((0,A.K)(l=>(this.messagesSrv.showErrors(l.error.Message?l.error.Message:l.status&&l.statusText?l.status+" "+l.statusText:l.message),this.approvals$.next(r),(0,C._)(()=>l))),(0,S.U)(()=>c))}getStatuses(){return this.http.get(`${I.N.apiUrl}/RequestData/GetAllRequestStatuses`).pipe((0,A.K)(e=>(this.messagesSrv.showErrors(e.error.Message?e.error.Message:e.status&&e.statusText?e.status+" "+e.statusText:e.message),(0,C._)(()=>e))),(0,S.U)(e=>e.map(s=>({status:s.Status,description:s.Description}))),(0,g.b)(e=>{this.statuses$.next(e)}))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(w.eN),t.LFG(E.K))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var U=a(8529),R=a(7632),W=a(7408),L=a(245),Q=a(7610),j=a(7785);function z(n,p){1&n&&(t.TgZ(0,"ion-buttons",6),t._UZ(1,"app-logout"),t.qZA())}function G(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"app-list",12),t.NdJ("modalOpen",function(o){t.CHM(e);const r=t.oxw(3);return t.KtG(r.openActionSheet(o))}),t.qZA()}if(2&n){const e=t.oxw(3);t.Q6J("data",e.approvalsData.data)("schema",e.schema)("buttons",e.buttons)}}function k(n,p){1&n&&(t.TgZ(0,"h1"),t._uU(1,"No Data"),t.qZA(),t._UZ(2,"ion-icon",13))}function K(n,p){if(1&n&&(t.TgZ(0,"ion-col",9),t.YNc(1,G,1,3,"app-list",10),t.YNc(2,k,3,0,"ng-template",null,11,t.W1O),t.qZA()),2&n){const e=t.MAs(3),s=t.oxw(2);t.xp6(1),t.Q6J("ngIf",s.approvalsData.data.length>0)("ngIfElse",e)}}function V(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"ion-col")(1,"app-table",12),t.NdJ("modalOpen",function(o){t.CHM(e);const r=t.oxw(2);return t.KtG(r.openActionSheet(o))}),t.qZA()()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("data",e.approvalsData)("schema",e.desktopSchema)("buttons",e.buttons)}}function X(n,p){if(1&n&&(t.TgZ(0,"ion-row",4),t.YNc(1,K,4,2,"ion-col",7),t.ALo(2,"async"),t.YNc(3,V,2,3,"ng-template",null,8,t.W1O),t.qZA()),2&n){const e=t.MAs(4),s=t.oxw();t.xp6(1),t.Q6J("ngIf",!1===t.lcZ(2,2,s.isDesktop$))("ngIfElse",e)}}let B=(()=>{class n{constructor(e,s,o,r,c,l,m){this.screenSizeSrv=e,this.approvalSrv=s,this.loadingSrv=o,this.actionSheetCtrl=r,this.alertCtrl=c,this.translate=l,this.modalCtrl=m,this.isDesktop$=this.screenSizeSrv.isDesktopView().pipe((0,g.b)(Z=>this.isDesktop=Z)),this.approvalsData=new N.by([]),this.buttons={updateStatus:{modal:"updateStatus",icon:"checklist",color:"primary",mobileIcon:"create",mobileColor:"secondary",tooltip:"btn.updateStatus"}},this.desktopSchema={properties:["requestorFullName","requestorDepartment","requestorWO","requestorForWO","requestorForProject","requestorWOManager","minutes","startTime","endTime","createdAt","reason"],noSearch:!0},this.schema={properties:["requestorFullName","minutes","reason","startTime","endTime","requestorDepartment","requestorWO","requestorWOManager","requestorForWO","requestorForProject","createdAt"],title:["requestorFullName"],subtitle:["requestorDepartment","requestorForProject"]},this.approvals$=this.loadingSrv.showLoaderUntilCompleted(this.approvalSrv.getMyApprovals()).pipe((0,O.w)(()=>this.approvalSrv.approvals),(0,g.b)(Z=>{this.approvalsData.data=Z}))}ngOnInit(){}openActionSheet(e){this.isDesktop?this.openModal(e.data):this.presentAlert(e.data)}openModal(e){var s=this;return(0,v.Z)(function*(){const o=yield s.modalCtrl.create({component:J,cssClass:"change-status-modal",componentProps:{request:e}});yield o.present();const r=yield o.onWillDismiss();if("confirm"===r.role){const c=+r.data.formValue.status,l=r.data.formValue.status.minutes;l?s.approvalSrv.updateStatus(+e.id,c,l).subscribe():s.approvalSrv.updateStatus(+e.id,c).subscribe()}})()}presentAlert(e){var s=this;return(0,v.Z)(function*(){const o=yield s.presentActionSheet();if(o)if(2===o){const r=yield s.alertCtrl.create({header:s.translate.instant("messagess.setDurationHeader"),buttons:[s.translate.instant("btn.approve")],inputs:[{value:e.minutes}]});yield r.present();const c=yield r.onDidDismiss();if(c.data){const l=Object.values(c.data.values)[0];s.approvalSrv.updateStatus(+e.id,o,l).subscribe()}}else s.approvalSrv.updateStatus(+e.id,o).subscribe()})()}presentActionSheet(){var e=this;return(0,v.Z)(function*(){const s=yield e.actionSheetCtrl.create({header:e.translate.instant("messagess.changeRequestStatusHeader"),buttons:[{text:e.translate.instant("btn.decline"),role:"destructive",data:{action:3}},{text:e.translate.instant("btn.approve"),data:{action:2}},{text:"Cancel",role:"cancel"}]});yield s.present();const o=yield s.onDidDismiss();return o.data?o.data.action:null})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(b.j),t.Y36(Y),t.Y36(U.b),t.Y36(i.BX),t.Y36(i.Br),t.Y36(h.sK),t.Y36(i.IN))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-approvals"]],decls:15,vars:11,consts:[[3,"translucent"],["slot","start"],["slot","end",4,"ngIf"],[1,"ion-padding",3,"fullscreen"],[1,"ion-padding-top"],["class","ion-padding-top",4,"ngIf"],["slot","end"],["size","12","size-md","8","push-md","2",4,"ngIf","ngIfElse"],["table",""],["size","12","size-md","8","push-md","2"],[3,"data","schema","buttons","modalOpen",4,"ngIf","ngIfElse"],["noData",""],[3,"data","schema","buttons","modalOpen"],["name","alert-circle-outline"]],template:function(e,s){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t._UZ(3,"ion-menu-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.YNc(7,z,2,0,"ion-buttons",2),t.ALo(8,"async"),t.qZA()(),t.TgZ(9,"ion-content",3),t._UZ(10,"app-loading")(11,"app-messages"),t.TgZ(12,"ion-grid",4),t.YNc(13,X,5,4,"ion-row",5),t.ALo(14,"async"),t.qZA()()),2&e&&(t.Q6J("translucent",!0),t.xp6(5),t.Oqu(t.lcZ(6,5,"pageTitles.myApprovals")),t.xp6(2),t.Q6J("ngIf",t.lcZ(8,7,s.isDesktop$)),t.xp6(2),t.Q6J("fullscreen",!0),t.xp6(4),t.Q6J("ngIf",t.lcZ(14,9,s.approvals$)))},dependencies:[d.O5,i.Sm,i.wI,i.W2,i.jY,i.Gu,i.gu,i.fG,i.Nd,i.wd,i.sr,R.n,W.a,L.N,Q.d,j.t,d.Ov,h.X$],styles:["ion-icon[_ngcontent-%COMP%]{font-size:16rem;width:16rem;margin:0 auto;position:relative;top:0;left:calc(50% - 8rem);color:#a9aabc}h1[_ngcontent-%COMP%]{text-align:center;margin-top:5rem;color:#a9aabc}"]}),n})();var H=a(1635),$=a(4212),tt=a(1227),et=a(591),st=a(3627),ot=a(6516);let nt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.ez,H.Bz.forChild([{path:"",component:B}]),u.u5,i.Pc,$.p,ot.U,et.I,tt.$,h.aw,st.I,u.UX,f.Fk,T.c]}),n})()}}]);